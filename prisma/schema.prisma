generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma"
}

// ========================
// ENUMS (mapeados do MySQL)
// ========================

enum colecoes_status {
  normal
  atrasado
  finalizado
  desabilitada
}

enum referencias_status {
  normal
  finalizada
  arquivada
  atraso_desenvolvimento
  atraso_logistica
  em_producao
}

enum etapas_producao_status {
  pendente
  em_andamento
  concluida
}

enum producao_status {
  normal
  atrasado
  finalizado
}

enum usuarios_status {
  ativo
  inativo
}

enum usuarios_nivel {
  admin
  usuario
  visualizador
}

// ========================
// MODELOS â€” PCP Flor Linda
// ========================

model Colecao {
  id                        Int              @id @default(autoincrement())
  nome                      String           @db.VarChar(100)
  codigo                    String           @db.VarChar(20)
  data_inicio               DateTime         @db.Date
  data_fim                  DateTime         @db.Date
  prazo_inicial_estilo      DateTime?        @db.Date
  prazo_final_estilo        DateTime?        @db.Date
  data_envio_prevista       DateTime?        @db.Date
  quantidade_total_producao Int?             @default(0)
  status                    colecoes_status? @default(normal)
  status_estilo             String?          @default("normal") @db.VarChar(50)
  created_at                DateTime         @default(now()) @db.Timestamp(0)
  updated_at                DateTime         @default(now()) @updatedAt @db.Timestamp(0)

  referencias               Referencia[]

  @@map("colecoes")
}

model Referencia {
  id                     Int                @id @default(autoincrement())
  colecao_id             Int
  codigo                 String             @db.VarChar(20)
  nome                   String             @db.VarChar(100)
  foto                   String?            @db.VarChar(255)
  tempo_producao         Int
  previsao_producao      Int
  producao_diaria_pessoa Int
  data_distribuicao      DateTime?          @db.Date
  media_dias_entrega     Int?
  localizacao_estoque    String?            @db.VarChar(50)
  status                 referencias_status @default(normal)
  quantidade_produzida   Int?               @default(0)
  para_marketing         Boolean?           @default(false)
  observacoes            String?            @db.Text
  created_at             DateTime           @default(now()) @db.Timestamp(0)
  updated_at             DateTime           @default(now()) @updatedAt @db.Timestamp(0)

  colecao                Colecao            @relation(fields: [colecao_id], references: [id])
  etapas                 EtapaProducao[]
  producoes              Producao[]

  @@index([colecao_id], map: "colecao_id")
  @@map("referencias")
}

model EtapaProducao {
  id            Int                     @id @default(autoincrement())
  referencia_id Int
  nome          String                  @db.VarChar(50)
  status        etapas_producao_status? @default(pendente)
  data_inicio   DateTime?               @db.Date
  data_fim      DateTime?               @db.Date
  observacoes   String?                 @db.Text
  created_at    DateTime                @default(now()) @db.Timestamp(0)
  updated_at    DateTime                @default(now()) @updatedAt @db.Timestamp(0)

  referencia    Referencia              @relation(fields: [referencia_id], references: [id])

  @@index([referencia_id], map: "referencia_id")
  @@map("etapas_producao")
}

model Producao {
  id             Int              @id @default(autoincrement())
  referencia_id  Int
  quantidade_dia Int
  data_producao  DateTime         @db.Date
  status         producao_status? @default(normal)
  observacoes    String?          @db.Text
  created_at     DateTime         @default(now()) @db.Timestamp(0)
  updated_at     DateTime         @default(now()) @updatedAt @db.Timestamp(0)

  referencia     Referencia       @relation(fields: [referencia_id], references: [id])

  @@index([referencia_id], map: "referencia_id")
  @@map("producao")
}

model Usuario {
  id         Int             @id @default(autoincrement())
  nome       String          @db.VarChar(255)
  email      String          @unique @db.VarChar(255)
  senha      String          @db.VarChar(255)
  nivel      usuarios_nivel  @default(visualizador)
  ativo      Boolean         @default(true)
  created_at DateTime        @default(now()) @db.Timestamp(0)
  updated_at DateTime        @default(now()) @updatedAt @db.Timestamp(0)

  perfis     UsuarioPerfil[]

  @@map("usuarios")
}

model Perfil {
  id         Int       @id @default(autoincrement())
  nome       String    @db.VarChar(255)
  descricao  String?   @db.Text
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  usuarios   UsuarioPerfil[]
  permissoes PerfilPermissao[]

  @@map("perfis")
}

model Permissao {
  id         Int       @id @default(autoincrement())
  nome       String    @db.VarChar(255)
  descricao  String?   @db.Text
  created_at DateTime  @default(now())
  updated_at DateTime  @updatedAt

  perfis     PerfilPermissao[]

  @@map("permissoes")
}

model PerfilPermissao {
  id           Int @id @default(autoincrement())
  perfil_id    Int
  permissao_id Int

  perfil       Perfil    @relation(fields: [perfil_id], references: [id])
  permissao    Permissao @relation(fields: [permissao_id], references: [id])

  @@map("perfil_permissao")
}

model UsuarioPerfil {
  id         Int @id @default(autoincrement())
  usuario_id Int
  perfil_id  Int

  usuario    Usuario @relation(fields: [usuario_id], references: [id])
  perfil     Perfil  @relation(fields: [perfil_id], references: [id])

  @@map("usuario_perfil")
}

model LogAtividade {
  id          Int      @id @default(autoincrement())
  usuario_id  Int?
  usuario_nome String  @db.VarChar(255)
  acao        String   @db.VarChar(50)
  entidade    String   @db.VarChar(50)
  entidade_id Int?
  descricao   String   @db.Text
  detalhes    String?  @db.Text
  ip          String?  @db.VarChar(45)
  created_at  DateTime @default(now()) @db.Timestamp(0)

  @@index([usuario_id])
  @@index([entidade])
  @@index([created_at])
  @@map("log_atividades")
}

model ConfigEmailRelatorio {
  id         Int      @id @default(autoincrement())
  email      String   @db.VarChar(255)
  nome       String   @db.VarChar(255)
  ativo      Boolean  @default(true)
  created_at DateTime @default(now()) @db.Timestamp(0)

  @@map("config_emails_relatorio")
}
